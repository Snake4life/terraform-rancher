apiVersion: v1
kind: ConfigMap
metadata:
  name: traefik-config
  labels:
    app: {{ template "traefikv2.name" . }}
    chart: {{ template "traefikv2.chart" . }}
    release: {{ .Release.Name | quote }}
    heritage: {{ .Release.Service | quote }}

data:
  traefik.yaml: |
    global:
      sendAnonymousUsage: true
    api:
      insecure: true
      dashboard: true
    ping: {} # Enable with defaults
    metrics:
      prometheus: {} # Enable with defaults
    log:
      level: INFO
    accessLog: {} # Enable with defaults
    entryPoints:
      web:
        address: :80
      websecure:
        address: :443
    forwardedHeaders:
      insecure: true
    providers:
      kubernetesCRD:
        ingressClass: traefik
        namespaces: [] # All namespaces
    certificatesResolvers:
      default:
        acme:
          storage: /acme/acme.json
          {{- if .Values.acme.staging }}
          caServer: "https://acme-staging-v02.api.letsencrypt.org/directory"
          {{- end }}
          {{- if eq .Values.acme.challengeType "dns-01" }}
          dnsChallenge:
            provider: {{ .Values.acme.dnsProvider.name | quote }}
            {{- if .Values.acme.delayBeforeCheck }}
            delayBeforeCheck: {{ .Values.acme.delayBeforeCheck }}
            {{- end }}
            {{- with .Values.acme.resolvers }}
            resolvers:
              {{- toYaml . | nindent 14 }}
            {{- end }}
          {{- end }}
